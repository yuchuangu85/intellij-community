// Copyright 2000-2021 JetBrains s.r.o. Use of this source code is governed by the Apache 2.0 license that can be found in the LICENSE file.
configurations {
  rkernel
}

dependencies {
  rkernel "org.jetbrains.intellij.deps.rkernel:rkernel:$rkernelVersion:osx@tar.gz"
  rkernel "org.jetbrains.intellij.deps.rkernel:rkernel:$rkernelVersion:windows@tar.gz"
  rkernel "org.jetbrains.intellij.deps.rkernel:rkernel:$rkernelVersion:linux@tar.gz"
}

task setupRkernel(dependsOn: configurations.rkernel) {
  group = 'rplugin'
  inputs.files(configurations.rkernel)
  outputs.dir("$buildDir/rplugin")
  copy {
    configurations.rkernel.files.each {
      from tarTree(it)
    }
    into("$buildDir/rplugin")
  }
}

task copyFsNotifierForRPlugin {
  setupRkernel.dependsOn(it)
  group = setupRkernel.group
  outputs.file("$buildDir/rplugin/fsnotifier-linux")
  copy {
    from "$projectDir/../../bin/linux/"
    into "$buildDir/rplugin/"
    include "fsnotifier64"
    rename "fsnotifier64", "fsnotifier-linux"
  }
  outputs.file("$buildDir/rplugin/fsnotifier-osx")
  copy {
    from "$projectDir/../../bin/mac/"
    into "$buildDir/rplugin/"
    include "fsnotifier"
    rename "fsnotifier", "fsnotifier-osx"
  }
  outputs.file("$buildDir/rplugin/fsnotifier-win.exe")
  copy {
    from "$projectDir/../../bin/win/"
    into "$buildDir/rplugin/"
    include "fsnotifier.exe"
    rename "fsnotifier.exe", "fsnotifier-win.exe"
  }
}